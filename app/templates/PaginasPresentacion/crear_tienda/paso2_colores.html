{% extends 'PaginasPresentacion/crear_tienda/base.html' %}

{% block paso_content %}
<h2>Crear tu tienda - Paso 2: Estilo visual</h2>

<form method="POST" enctype="multipart/form-data">
  <label for="color_principal">Color principal</label>
  <input type="color" name="color_principal" id="color_principal" value="{{ tienda.color_principal or '#303f9f' }}">

  <label for="color_secundario">Color secundario</label>
  <input type="color" name="color_secundario" id="color_secundario" value="{{ tienda.color_secundario or '#1a237e' }}">

  <label for="color_fondo">Color de fondo</label>
  <input type="color" name="color_fondo" id="color_fondo" value="{{ tienda.color_fondo or '#ffffff' }}">

  <label for="logo">Logo de la tienda</label>
  <input type="file" name="logo" id="logo" accept="image/*">

  {% if tienda.logo_url %}
    <p>Logo actual:</p>
    <img src="{{ tienda.logo_url }}" alt="Logo actual" style="max-height: 80px;">
  {% endif %}

  <div id="preview-logo" style="margin-top: 10px;"></div>

  <hr>

  <label for="tipo_web">Tipo de web</label>
  <select name="tipo_web" id="tipo_web">
    <option value="tienda" {% if tienda.tipo_web == 'tienda' %}selected{% endif %}>Tienda</option>
    <option value="informacion" {% if tienda.tipo_web == 'informacion' %}selected{% endif %}>Página informativa</option>
  </select>

  <div id="plantillas-container" style="margin-top: 20px;">
    <p>Elige una plantilla:</p>
    <div id="plantillas-tienda" class="grupo-plantillas" style="display: none;">
      <label>
        <input type="radio" name="plantilla" value="tienda_1" {% if tienda.plantilla == 'tienda_1' %}checked{% endif %}>
        <img src="/static/imgs/plantillas/PlantillaTienda1.png" alt="Plantilla Tienda 1" style="max-width: 200px;">
      </label>
      <label>
        <input type="radio" name="plantilla" value="tienda_2" {% if tienda.plantilla == 'tienda_2' %}checked{% endif %}>
        <img src="/static/imgs/plantillas/PlantillaTienda2.png" alt="Plantilla Tienda 2" style="max-width: 200px;">
      </label>
    </div>

    <div id="plantillas-informacion" class="grupo-plantillas" style="display: none;">
      <label>
        <input type="radio" name="plantilla" value="info_1" {% if tienda.plantilla == 'info_1' %}checked{% endif %}>
        <img src="/static/imgs/plantillas/PlantillaInformacion2.png" alt="Plantilla Información 1" style="max-width: 200px;">
      </label>
      <label>
        <input type="radio" name="plantilla" value="info_2" {% if tienda.plantilla == 'info_2' %}checked{% endif %}>
        <img src="/static/imgs/plantillas/PlantillaInformacion2.png" alt="Plantilla Información 2" style="max-width: 200px;">
      </label>
    </div>
  </div>

  <button type="submit" style="margin-top: 2rem;">Siguiente</button>
</form>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("etiqueta-paso").textContent = "2";
    document.getElementById("progreso").setAttribute("stroke-dasharray", "50, 100");

    const tipoWebSelect = document.getElementById("tipo_web");
    const tiendaGroup = document.getElementById("plantillas-tienda");
    const infoGroup = document.getElementById("plantillas-informacion");

    function mostrarPlantillas(tipo) {
      tiendaGroup.style.display = tipo === "tienda" ? "block" : "none";
      infoGroup.style.display = tipo === "informacion" ? "block" : "none";
    }

    tipoWebSelect.addEventListener("change", () => {
      mostrarPlantillas(tipoWebSelect.value);
    });

    mostrarPlantillas(tipoWebSelect.value); // Inicializa correctamente

    // Previsualización de logo
    const inputLogo = document.getElementById("logo");
    const previewDiv = document.getElementById("preview-logo");

    inputLogo.addEventListener("change", () => {
      const file = inputLogo.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          previewDiv.innerHTML = `<p>Previsualización del logo:</p><img src="${e.target.result}" alt="Previsualización" style="max-height: 80px;">`;
        };
        reader.readAsDataURL(file);
      } else {
        previewDiv.innerHTML = "";
      }
    });
  });
</script>
{% endblock %}
